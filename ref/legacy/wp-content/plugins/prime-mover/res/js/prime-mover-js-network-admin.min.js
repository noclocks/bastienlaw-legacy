(function(e){e(function(){PrimeMoverCoreJsObject.init()}),window.PrimeMoverCoreJsObject={init:function(){this.handleExportType(),this.doExport(),this.doImport(),this.exportAutomation(),this.restoreBackupFree()},restoreBackupFree:function(){var e=this.getUrlParameter("prime_mover_backup_path"),r=this.getUrlParameter("prime_mover_backup_blogid");if(e&&r){var o=this.prime_mover_migration_tools;window.history.replaceState({},"Title",o);PrimeMoverCoreJsObject.initiateSpinner(r),PrimeMoverCoreJsObject.prime_mover_track_progress("import",r,!1,{import_restorepath:e})}},prime_mover_migration_tools:prime_mover_js_ajax_renderer.prime_mover_migration_tools_url,exportAutomation:function(){var r=this.getUrlParameter("blog_id"),o=this.getUrlParameter("action");if("prime_mover_create_backup_action"===o&&r){e("#js-prime_mover_exporting_blog_"+r).click();var s=this.prime_mover_migration_tools;window.history.replaceState({},"Title",s)}},getUrlParameter:function(e){var r,o,s=window.location.search.substring(1),t=s.split("&");for(o=0;o<t.length;o++)if(r=t[o].split("="),r[0]===e){var n=r[1];return void 0===r[1]||decodeURIComponent(n.replace(/\+/g," "))}},handleExportType:function(){e(".js-prime-mover-export-type").change(function(){e(".js-prime-mover-export-now-button").prop("disabled",!0);var r=e(this).attr("data-blog-id"),o=e(this).val();"multisite-export"===o?(e("#js-prime-mover-export-to-multisite-div-"+r).slideToggle(),e("#js-prime-mover-export-targetid-"+r).val(""),e(".js-prime-mover-export-now-button").prop("disabled",!0),e("#js-prime-mover-export-targetid-"+r).on("keyup",function(){var r=e(this).val();r=r.trim(),e(".js-prime-mover-export-now-button").prop("disabled",!0),r&&PrimeMoverCoreJsObject.isValidBlogId(r)&&e(".js-prime-mover-export-now-button").prop("disabled",!1)})):(e("#js-prime-mover-export-to-multisite-div-"+r).slideUp(),e(".js-prime-mover-export-now-button").prop("disabled",!1))})},isValidBlogId:function(e){var r=Math.floor(+e);return r!==1/0&&r+""===e&&0<r},searchInObject:function(e,r,o,s){if("undefined"==typeof o)var o="bool";if("undefined"==typeof s)var s=!0;for(var t=0;t<r.length;t++){if(s&&r[t].filename===e){if("bool"===o)return!0;if("key"===o)return t}var n=r[t].filename;if(!1===s&&n.includes(e)&&"bool"===o)return!0}return!1},doImport:function(){e("body").on("click","input.js-prime_mover_importbrowsefile",function(){e(this).val(null);var r=e(this).attr("data-multisiteblogid");r&&(e("#js-prime_mover_import_progress_span_p_"+r).removeClass("notice notice-success"),e("#js-prime_mover_import_progress_span_p_"+r).removeClass("notice notice-error"),e("#js-multisite_import_span_"+r).removeClass("notice notice-error prime-mover-corrupt-package-error"),PrimeMoverCoreJsObject.cleanProgressSpans(r,"import"))}),e("body").on("change","input.js-prime_mover_importbrowsefile",function(){var r=e(this).attr("data-multisiteblogid");if(0<parseInt(r)&&0<parseInt(e(this)[0].files[0].size)){var o=PrimeMoverCoreJsObject.getGenericFailSelector(r);PrimeMoverCoreJsObject.initializeDialogMonitor(o,!0);var s=e(this).val().split(".").pop().toLowerCase();if(-1==e.inArray(s,["zip","wprime"]))PrimeMoverCoreJsObject.user_notices("#js-prime-mover-wrong-filetype-"+r,0,"",!1,prime_mover_js_ajax_renderer.prime_mover_invalid_package);else if(prime_mover_js_ajax_renderer.prime_mover_phpuploads_misconfigured)PrimeMoverCoreJsObject.user_notices("#js-prime-mover-wrong-filetype-"+r,r,"import",!0,prime_mover_js_ajax_renderer.prime_mover_upload_misconfiguration_error);else if("readonly"===prime_mover_js_ajax_renderer.prime_mover_config_writable)PrimeMoverCoreJsObject.user_notices("#js-prime-mover-wrong-filetype-"+r,r,"import",!0,prime_mover_js_ajax_renderer.prime_mover_caching_enabled_error);else if(-1!==e.inArray(s,["wprime"])){PrimeMoverCoreJsObject.initiateSpinner(r,"zip_analysis");var t=e(this)[0].files[0],i=t.size,n=+prime_mover_js_ajax_renderer.prime_mover_browser_upload_limit;if(i>n)error=prime_mover_js_ajax_renderer.prime_mover_exceeded_browser_limit,error=error.replace("{{WPRIME_EXPORT_PATH}}",prime_mover_js_ajax_renderer.wprime_export_path+r),PrimeMoverCoreJsObject.user_notices("#js-prime-mover-wrong-filetype-"+r,r,"import",!0,error);else{let e=t;archiveOpenFile(e,"",function(e){e&&PrimeMoverCoreJsObject.readFootPrintFromTar(e,r,t)})}}else if("no"===prime_mover_js_ajax_renderer.is_zip_extension_installed)PrimeMoverCoreJsObject.user_notices("#js-prime-mover-wrong-filetype-"+r,r,"import",!0,prime_mover_js_ajax_renderer.no_zip_extension_error);else{PrimeMoverCoreJsObject.initiateSpinner(r,"zip_analysis");var t=e(this)[0].files[0];PrimeMoverCoreJsObject.processZipJs(t,r)}}})},getFileBasename:function(e){return e.replace(/.*\//,"")},getTarPackageRestoreMode:function(e){var r=[],o=e.export_options;return"complete_export_mode"===o?r.complete_export_mode=prime_mover_js_ajax_renderer.prime_mover_export_mode_texts.complete_export_mode:"development_package"===o?r.development_package=prime_mover_js_ajax_renderer.prime_mover_export_mode_texts.development_package:"db_and_media_export"===o?r.db_and_media_export=prime_mover_js_ajax_renderer.prime_mover_export_mode_texts.db_and_media_export:"dbonly_export"===o&&(r.dbonly_export=prime_mover_js_ajax_renderer.prime_mover_export_mode_texts.dbonly_export),r},readFootPrintFromTar:function(r,o,s){let t=[];var i="";for(let e of r.entries){var n=PrimeMoverCoreJsObject.getFileBasename(e.name);if(prime_mover_js_ajax_renderer.prime_mover_wprime_config===n){i=PrimeMoverCoreJsObject.dirname(e.name),i=i[0],t[i]=e;break}}for(var p in r.entries=t,r.entries){var a=r.entries[p];a.is_file&&a.readData(function(r){let t=new Blob([r],{type:"application/json"});var n=new FileReader;n.addEventListener("loadend",function(r){var t=r.srcElement.result,n=JSON.parse(t),p=PrimeMoverCoreJsObject.getTarPackageRestoreMode(n),a=n.encrypted,_=n.prime_mover_encrypted_signature;if(a){var l={action:"prime_mover_verify_encrypted_package",dataType:"json",stringtocheck:_,encrypted_media:"true",prime_mover_decryption_check_nonce:prime_mover_js_ajax_renderer.prime_mover_decryption_check_nonce,blog_id:o,package_ext:"wprime"};e.post(ajaxurl,l,function(e){if(e.result)PrimeMoverCoreJsObject.triggerImportAfterPackageCheck(t,o,i,s,!0,p,!0,!0);else{var r=e.error;PrimeMoverCoreJsObject.user_notices("#js-prime-mover-wrong-filetype-"+o,o,"import",!0,r)}}).fail(function(){var e=this;PrimeMoverCoreJsObject.doErrorHandling(o,"import",e,null,!0,"handleEncryptedPackageCheck")})}else PrimeMoverCoreJsObject.triggerImportAfterPackageCheck(t,o,i,s,!1,p,!1,!0)}),n.readAsText(t)})}},dirname:function(e){return e.match(/.*\//)},processZipJs:function(e,r){zip.workerScriptsPath=prime_mover_js_ajax_renderer.prime_mover_zipjs_workers,zip.createReader(new zip.BlobReader(e),function(o){o.getEntries(function(s){if(s.length){var t=s[0].filename,i=t+"signature.enc",n=!1,p=!1,a=PrimeMoverCoreJsObject.searchInObject(i,s,"key");!1!==a&&(n=!0);var _=PrimeMoverCoreJsObject.searchInObject(t+"media.enc",s,"key");!1!==_&&(p=!0),PrimeMoverCoreJsObject.handleEncryptedPackageCheck(n,i,s,a,o,e,t,r,p)}else PrimeMoverCoreJsObject.user_notices("#js-prime-mover-wrong-filetype-"+r,r,"import",!0,prime_mover_js_ajax_renderer.prime_mover_invalid_package)})},function(o){var s=e.size,t=+prime_mover_js_ajax_renderer.prime_mover_browser_upload_limit;s>t&&(o=prime_mover_js_ajax_renderer.prime_mover_exceeded_browser_limit,o=o.replace("{{WPRIME_EXPORT_PATH}}",prime_mover_js_ajax_renderer.wprime_export_path+r)),PrimeMoverCoreJsObject.user_notices("#js-prime-mover-wrong-filetype-"+r,r,"import",!0,o)})},getRandomString:function(e){for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789~!@#$%^&*()_+`-=[]{}|;':,./<>?",o="",s=0;s<1024*(1024*e);s++)o+=r.charAt(Math.floor(Math.random()*r.length));return o},checkUploadSpeed:function(){return new Promise(function(e){var r,o=new XMLHttpRequest,s="?cache="+Math.floor(1e4*Math.random()),t=PrimeMoverCoreJsObject.getRandomString(1);o.onreadystatechange=function(){if(4===o.readyState){if(200===o.status)return s=Math.round(1024/((new Date-r)/1e3)),e(s);var s=!1;return e(s)}},o.open("POST",s,!0),r=new Date,o.send(t)})},calculateChunkSizeBasedOnUploadSpeed:function(e){var r=+prime_mover_js_ajax_renderer.prime_mover_slice_size,o=16777216,s=r;if(o<r&&(s=o),!e)return 98304;e=+e;var t=1024*(15*e);return t<s&&(s=t),s},calculateUploadSpeed:function(e){return new Promise(async function(r){var o=[];for(var s of[1,2])speed_data=await PrimeMoverCoreJsObject.checkUploadSpeed(),speed_data&&o.push(speed_data),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(e,"Upload speed measurement data: "+speed_data,"import","calculateUploadSpeed");if(0==o.length)return r(!1);const t=o.filter(e=>!isNaN(e)).map(Number),i=t.reduce((e,r)=>e+r)/(t.length||1);return r(i)})},doAfterPackageClientValidation:function(e,r,o,s,t,i,n){var p=PrimeMoverCoreJsObject.analyzeRestoreMode(r,s,t),a=PrimeMoverCoreJsObject.searchInObject(s+"footprint.json",r,"key");a?r[a].getData(new zip.TextWriter,function(r){PrimeMoverCoreJsObject.triggerImportAfterPackageCheck(r,t,s,e,i,p,n,!1),o.close(function(){})},function(){}):PrimeMoverCoreJsObject.user_notices("#js-prime-mover-wrong-filetype-"+t,t,"import",!0,prime_mover_js_ajax_renderer.prime_mover_invalid_package)},triggerImportAfterPackageCheck:async function(e,r,o,s,t,i,n){var p=JSON.parse(e),a=prime_mover_js_ajax_renderer.prime_mover_environment,_=p.site_title,l=+r,m="#js-prime-mover-wrong-importedsite-"+r;o.replace(/\s+/g,"");var d=PrimeMoverCoreJsObject.getBlogIDfromFolderName(o),c="",g=prime_mover_js_ajax_renderer.prime_mover_mainsite_id;$match=!0;var u="";if("prime_mover_export_type"in p&&(u=p.prime_mover_export_type),d&&l||($match=!1,c=prime_mover_js_ajax_renderer.prime_mover_package_mismatch_undefined_blogid),$match&&u&&u!==a&&(c=prime_mover_js_ajax_renderer.prime_mover_package_mismatch_export_type,c=c.replace("{{SOURCE_PACKAGE_TYPE}}",p.prime_mover_export_type),c=c.replace("{{TARGET_PACKAGE_TYPE}}",a),$match=!1),$match&&d!==l&&($match=!1),$match||c||u||"multisite"!==a||1!==d||(c=prime_mover_js_ajax_renderer.prime_mover_package_mismatch_export_type,c=c.replace("{{SOURCE_PACKAGE_TYPE}}","single-site"),c=c.replace("{{TARGET_PACKAGE_TYPE}}",a),$match=!1),$match||c||"multisite"!==a||(c=prime_mover_js_ajax_renderer.prime_mover_package_mismatch_subsite_mismatch),$match||c||"single-site"!==a||(c=prime_mover_js_ajax_renderer.prime_mover_package_mismatch_singlesite_mismatch),$match&&"multisite"===a&&r===g&&!u&&($match=!1,c=prime_mover_js_ajax_renderer.prime_mover_package_mismatch_mainsite),$match){let e=await PrimeMoverCoreJsObject.calculateUploadSpeed(r);var v=PrimeMoverCoreJsObject.generateUniqueIdentifier("import",r,"_uploadSpeedId_");PrimeMoverCoreJsObject[v]=e,!1===e?PrimeMoverCoreJsObject.user_notices(m,l,"import",!0,prime_mover_js_ajax_renderer.prime_mover_bailout_upload_text,void 0,void 0,void 0,prime_mover_js_ajax_renderer.prime_mover_package_error_heading):(PrimeMoverCoreJsObject.cleanProgressSpans(r,"import"),PrimeMoverCoreJsObject.generalImportWarningDialog(r,s,"","","",t,i,_,s.name,"",n))}else PrimeMoverCoreJsObject.user_notices(m,l,"import",!0,c,void 0,void 0,void 0,prime_mover_js_ajax_renderer.prime_mover_package_mismatch_heading)},handleEncryptedPackageCheck:function(r,o,s,t,i,n,p,a,_){r?s[t].getData(new zip.TextWriter,function(o){var t={action:"prime_mover_verify_encrypted_package",dataType:"json",stringtocheck:o,encrypted_media:_,prime_mover_decryption_check_nonce:prime_mover_js_ajax_renderer.prime_mover_decryption_check_nonce,blog_id:a,package_ext:"zip"};e.post(ajaxurl,t,function(e){if(e.result)PrimeMoverCoreJsObject.doAfterPackageClientValidation(n,s,i,p,a,r,_);else{var o=e.error;PrimeMoverCoreJsObject.user_notices("#js-prime-mover-wrong-filetype-"+a,a,"import",!0,o),i.close(function(){})}}).fail(function(){var e=this;PrimeMoverCoreJsObject.doErrorHandling(a,"import",e,null,!0,"handleEncryptedPackageCheck")})},function(){}):PrimeMoverCoreJsObject.doAfterPackageClientValidation(n,s,i,p,a,r,_)},analyzeRestoreMode:function(e,r){var o=[],s=r+"media.zip";return PrimeMoverCoreJsObject.searchInObject(r+"plugins/",e,"bool",!1)?PrimeMoverCoreJsObject.searchInObject(s,e)?o.complete_export_mode=prime_mover_js_ajax_renderer.prime_mover_export_mode_texts.complete_export_mode:o.development_package=prime_mover_js_ajax_renderer.prime_mover_export_mode_texts.development_package:PrimeMoverCoreJsObject.searchInObject(s,e)?o.db_and_media_export=prime_mover_js_ajax_renderer.prime_mover_export_mode_texts.db_and_media_export:o.dbonly_export=prime_mover_js_ajax_renderer.prime_mover_export_mode_texts.dbonly_export,o},humanFileSize:function(e,r){var o=r?1e3:1024;if(Math.abs(e)<o)return e+" B";var s=r?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],t=-1;do e/=o,++t;while(Math.abs(e)>=o&&t<s.length-1);return e.toFixed(1)+" "+s[t]},computeTimeToUpload:function(e,r){var o=this.calculateChunkSizeBasedOnUploadSpeed(e),s=r/o*(5/60),t=.02*s;s+=t;var i=this.roundUp(s,0),n=this.computeUploadRefreshFactor();return i*=n,2>i?i+" "+prime_mover_js_ajax_renderer.prime_mover_minute_text:i+" "+prime_mover_js_ajax_renderer.prime_mover_minutes_text},computeUploadRefreshFactor:function(){var e=prime_mover_js_ajax_renderer.prime_mover_upload_refresh_interval;return 1/5*e*(1/1e3)},roundUp:function(e,r){return r=Math.pow(10,r),Math.ceil(e*r)/r},measuredUploadSpeed:function(e){PrimeMoverCoreJsObject.logProcessingErrorAnalysis(e,"Is local: "+prime_mover_js_ajax_renderer.is_local_server,"import","measuredUploadSpeed");var r=this.generateUniqueIdentifier("import",e,"_uploadSpeedId_"),o=!1;return PrimeMoverCoreJsObject.isUniqueIdentifierSet(r)&&(o=PrimeMoverCoreJsObject[r]),o},setDialogWarningRestoreInfoText:function(r,o,s,t,i,n,p,a,_,l,m){var d,c=r+" .js-prime-mover-warning-restoration-mode",g=r+" .js-prime-mover-warning-target-blog-id",u=r+" .js-prime-mover-warning-restoring-encrypted",v=r+" .js-prime-mover-encrypted-wprime",h=r+" .js-prime-mover-encrypted-package-note",f=r+" .js-prime-mover-warning-scope-mode",y=r+" .js-prime-mover-encrypted-media",f=r+" .js-prime-mover-warning-scope-mode",x=r+" #js-restoration-encrypted-mediafiles-prime-mover",E=r+" #js-restoration-encrypted-wprime",A=r+" #js-restoration-encrypted-database-prime-mover",j=PrimeMoverCoreJsObject.measuredUploadSpeed(o);j&&(d=PrimeMoverCoreJsObject.computeTimeToUpload(j,l),e(r+" #js-prime-mover-computed-uploadtime").text(d),e(r+" .js-prime-mover-upload-option-selected").show()),m?e(v).html(prime_mover_js_ajax_renderer.prime_mover_restore_noencryption_warning):(e(u).html(prime_mover_js_ajax_renderer.prime_mover_restore_noencryption_warning),e(y).html(prime_mover_js_ajax_renderer.prime_mover_restore_noencryption_warning));var P="",k="";for(var b in i)P=b,k=i[P];e(x).hide(),e(E).hide(),"complete_export_mode"!=P&&"db_and_media_export"!==P||m||e(x).show(),e(f).html(k),e(h).html(""),e(r+" .js-prime-mover-package-size-dialog").html(a),m?(e(E).show(),e(A).hide(),e(x).hide()):e(A).show(),!0===t&&(m?e(v).html(prime_mover_js_ajax_renderer.prime_mover_restore_encrypted_package_warning):(e(u).html(prime_mover_js_ajax_renderer.prime_mover_restore_encrypted_package_warning),e(h).html(prime_mover_js_ajax_renderer.prime_mover_encrypted_note))),!0!==_||m||e(y).html(prime_mover_js_ajax_renderer.prime_mover_restore_encrypted_package_warning),"restore_within_server"===s?e(c).html(prime_mover_js_ajax_renderer.prime_mover_restorewithinserver_mode):"restore_from_remote_url"===s?e(c).html(prime_mover_js_ajax_renderer.prime_mover_restore_remote_url_mode):e(c).html(prime_mover_js_ajax_renderer.prime_mover_upload_package_mode),g.length&&e(g).html(o),e(r+" .js-prime-mover-warning-target-site-title").html(n),e(r+" .js-prime-mover-warning-source-of-origin").html(p)},generalImportWarningDialog:function(r,o,s,t,i,n,p,a,_,l,m){if("undefined"==typeof s)var s=!1;if("undefined"==typeof t)var t=null;if("undefined"==typeof i)var i=null;if("undefined"==typeof n)var n=null;if("undefined"==typeof p)var p=[];if("undefined"==typeof a)var a=null;if("undefined"==typeof _)var _=null;if("undefined"==typeof l)var l=null;if("undefined"==typeof m)var m=!1;PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"General Import warning triggered.","import","generalImportWarningDialog"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Import package: "+o,"import","generalImportWarningDialog"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Gearbox call: "+s,"import","generalImportWarningDialog"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Restore path: "+t,"import","generalImportWarningDialog"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Restore mode: "+i,"import","generalImportWarningDialog"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Site title: "+a,"import","generalImportWarningDialog"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Source: "+_,"import","generalImportWarningDialog");var d,c="#js-prime-mover-import-warning-confirm-"+r,g=e(c),u=e(g).data();if(!l){var l=o.size;d=l,l=this.humanFileSize(l,!0)}u.gearbox_call=s,u.restore_path=t,u.restore_mode=i;var v=!1;PrimeMoverCoreJsObject.isWprimePackage(s,t,_)&&(v=!0),PrimeMoverCoreJsObject.setDialogWarningRestoreInfoText(c,r,i,n,p,a,_,l,m,d,v),e(g).dialog({resizable:!1,height:"auto",width:"auto",maxWidth:600,dialogClass:"prime-mover-user-dialog",modal:!0,fluid:!0,buttons:[{text:prime_mover_js_ajax_renderer.yes_button,class:"button-primary",click:function(){e(this).dialog("close");var s=e(this).data("gearbox_call");if(s){var i={import_restorepath:t};PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Gearbox same site server restoration and user confirms warning","import","generalImportWarningDialog"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,i,"import","generalImportWarningDialog"),PrimeMoverCoreJsObject.initiateSpinner(r),PrimeMoverCoreJsObject.prime_mover_track_progress("import",r,!1,i)}else{PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Core upload support and user confirms warning, firing import handler.","import","generalImportWarningDialog");var i={import_package_upload:o};PrimeMoverCoreJsObject.initiateSpinner(r),PrimeMoverCoreJsObject.prime_mover_track_progress("import",r,!1,i)}}},{text:prime_mover_js_ajax_renderer.cancel_button,click:function(){var o=this;e(o).dialog("close"),PrimeMoverCoreJsObject.doWhenImportWarningIsCancelled(r,o,i,t)}}],create:function(){var o=this;e(o).closest("div.ui-dialog").find(".ui-dialog-titlebar-close").click(function(){i=e(o).data("restore_mode"),t=e(o).data("restore_path"),PrimeMoverCoreJsObject.doWhenImportWarningIsCancelled(r,o,i,t)})},open:function(){e(".ui-dialog a").blur()}}),PrimeMoverCoreJsObject.handle_responsive_dialog()},isWprimePackage:function(e,r,o){var s="";e&&r&&(s=PrimeMoverCoreJsObject.getFileBasename(r)),!s&&o&&(s=o);var t=s.split(".").pop().toLowerCase();return"wprime"===t},doWhenImportWarningIsCancelled:function(r,o,s,t){PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"User does not want to confirm import warning, cancelled.","import","generalImportWarningDialog");var i=e(o).data("gearbox_call");i&&"restore_from_remote_url"===s&&PrimeMoverCoreJsObject.requestToDeleteTmpFile(t,r,!1,!0,"import","yes"),PrimeMoverCoreJsObject.stop_interval_clear_progress_text(r,!0,"import",!0),PrimeMoverCoreJsObject.lockDownButtons(r,!1)},lockDownButtons:function(r,o){if(r){if("undefined"==typeof o)var o=!0;for(var s,t="#js-prime-mover-browseupload-label-"+r,n=["#js-prime_mover_exporting_blog_"+r,"#js-prime_mover_importing_blog_"+r,"#js-prime_mover_restorebackup_"+r],p=n.length,a=0;a<p;a++)s=n[a],e(s).length&&(o?e(s).prop("disabled",!0):e(s).prop("disabled",!1));e("a.js-prime-mover-contact-dev").length&&(o?e("a.js-prime-mover-contact-dev").addClass("prime-mover-disabled-links disabled"):e("a.js-prime-mover-contact-dev").removeClass("prime-mover-disabled-links disabled")),e(t).length&&(o?e(t).addClass("disabled"):e(t).removeClass("disabled"))}},doExport:function(){e(".js-prime-mover-sites-page").on("click","input.js-prime_mover_exportbutton",function(){var r=e(this).attr("data-multisiteblogid"),o=e(this).attr("data-primemover-button-class");e("#js-prime-mover-export-dialog-confirm-"+r).dialog({resizable:!1,height:"auto",width:"auto",maxWidth:600,dialogClass:"prime-mover-user-dialog",modal:!0,fluid:!0,buttons:[{text:prime_mover_js_ajax_renderer.export_now_button,class:"js-prime-mover-export-now-button button-primary",click:function(){e(this).dialog("close");var o=e("input[name=prime-mover-export-mode-"+r+"]:checked").val();o&&PrimeMoverCoreJsObject.prime_mover_exporter(o,r)}},{text:prime_mover_js_ajax_renderer.cancel_button,click:function(){e(this).dialog("close")}}],close:function(){PrimeMoverCoreJsObject.hideClipBoardButton(r),e("#js-prime_mover_exporting_blog_"+r).removeClass("button"),e("#js-prime_mover_exporting_blog_"+r).addClass(o)},open:function(){e("#js-prime_mover_export_progress_span_p_"+r).removeClass("notice notice-success"),e("#js-prime_mover_export_progress_span_p_"+r).removeClass("notice notice-error"),e("#js-multisite_import_span_"+r).removeClass("notice notice-error prime-mover-corrupt-package-error"),e("#js-prime_mover_import_progress_span_p_"+r).removeClass("notice notice-success"),e("#js-prime_mover_import_progress_span_p_"+r).removeClass("notice notice-error"),e(".js-prime-mover-export-now-button").prop("disabled",!0),e("#js-multisite_export_span_"+r).html(""),PrimeMoverCoreJsObject.cleanProgressSpans(r,"export"),PrimeMoverCoreJsObject.cleanProgressSpans(r,"import"),e("#js-prime_mover_exporting_blog_"+r).removeClass("button-primary"),e("#js-prime_mover_exporting_blog_"+r).addClass("button"),e("#js-prime-mover-export-targetid-"+r).length&&e("#js-prime-mover-export-targetid-"+r).val(""),e("#js-prime-mover-export-as-single-site-"+r).prop("checked",!1),e("#js-prime-mover-export-as-multisite-"+r).prop("checked",!1),e("#js-prime-mover-export-to-multisite-div-"+r).length&&e("#js-prime-mover-export-to-multisite-div-"+r).hide()}}),PrimeMoverCoreJsObject.handle_responsive_dialog()})},hideClipBoardButton:function(r){var o="#js-prime-mover-copy-url-clipboard-"+r;e(o).length&&e(o).hide()},generateUniqueIdentifier:function(e,r,o){if("undefined"==typeof o)var o="_refreshID_";var s=e+o+r;return s},isUniqueIdentifierSet:function(e){return!!PrimeMoverCoreJsObject.hasOwnProperty(e)},doBootActions:function(e,r,o){if(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Doing boot actions..",e,"doBootActions"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,o,e,"doBootActions"),"import_restorepath"in o&&o.import_restorepath){PrimeMoverCoreJsObject.lockDownButtons(r,!0);var s=o.import_restorepath;PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Restore path: "+s,e,"doBootActions"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Gearbox called and user confirms warning, firing import handler.","import","doBootActions"),PrimeMoverCoreJsObject.import_handler(r,s)}else if(o instanceof FormData)this.doDiffPostAjax(e,r,o);else if("import_package_upload"in o){PrimeMoverCoreJsObject.lockDownButtons(r,!0);var t=o.import_package_upload;PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Core import package upload triggered after boot.","import","doBootActions"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,t,"import","doBootActions"),PrimeMoverCoreJsObject.user_confirms_import_to_proceed(r,t)}else if("prime_mover_export_nonce"in o)PrimeMoverCoreJsObject.lockDownButtons(r,!0),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Core export support requested after boot","export","doBootActions"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,o,"import","doBootActions"),PrimeMoverCoreJsObject.doExporterAjax(r,o);else if("import_package_url"in o){PrimeMoverCoreJsObject.lockDownButtons(r,!0),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Gearbox restore from remote URL requested after boot","export","doBootActions"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,o,"import","doBootActions");var i=o.import_package_url;PrimeMoverCoreJsObject.fetchFileToRestore(i,r)}},fetchFileToRestore:function(r,o){var s={action:"prime_mover_download_remote_url",dataType:"json",package_url:r,prime_mover_downloadfile_nonce:prime_mover_js_ajax_renderer.prime_mover_downloadfile_nonce,blog_id:o},t=new Date().getTime();e.ajax({url:ajaxurl,type:"post",data:s,retryLimit:prime_mover_js_ajax_renderer.prime_mover_retry_limit,tryCount:0,success:function(e){PrimeMoverCoreJsObject.prime_mover_is_js_object(e)&&"retry_download"in e&&(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Retrying fetching package request URL: "+r,"import","fetchFileToRestore"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Retrying fetching package request for blog ID: "+o,"import","fetchFileToRestore"),setTimeout(function(){PrimeMoverCoreJsObject.fetchFileToRestore(r,o)},prime_mover_js_ajax_renderer.prime_mover_fetch_restore_core_interval))},error:function(e,r,s){PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"FetchFilesRestore failed detected, error thrown is "+s,"import","fetchFileToRestore");var i=PrimeMoverCoreJsObject.generateUniqueIdentifier("import",o),n=PrimeMoverCoreJsObject.generateProgressIdentifier(i,"import"),p=!1,a=!1;if("undefined"!=typeof PrimeMoverCoreJsObject[n]){var _=PrimeMoverCoreJsObject[n];_&&(p=!0),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Latest progress fetch file to restore check: "+_,"import","fetchFileToRestore")}if(!p){a=!0,PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"FetchFilesRestore failed detected, retry status is "+a,"import","fetchFileToRestore");var l=this;PrimeMoverCoreJsObject.doErrorHandling(o,"import",l,null,a,"fetchFileToRestore")}else{var m=Math.round((new Date().getTime()-t)/1e3);s||(s=prime_mover_js_ajax_renderer.prime_mover_unknown_js_error);var d=prime_mover_js_ajax_renderer.prime_mover_downloadzip_error_message;d=d.replace("{{PROGRESSSERVERERROR}}",s),d=d.replace("{{BLOGID}}",o),d=d.replace("{{FIXEDSECONDS}}",m);var c="";PrimeMoverCoreJsObject.download_tmp_path&&(c=PrimeMoverCoreJsObject.download_tmp_path),c&&(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Temporary downloaded zip file to be deleted: "+c,"import","fetchFileToRestore"),PrimeMoverCoreJsObject.requestToDeleteTmpFile(c,o,!1,!1,"import","yes")),PrimeMoverCoreJsObject.stop_interval_clear_progress_text(o,!0,"import",!0);var g=PrimeMoverCoreJsObject.getGenericFailSelector(o);!1===PrimeMoverCoreJsObject.dialogIsOpen(g,!0)&&PrimeMoverCoreJsObject.user_notices(g,o,"import",!0,d),PrimeMoverCoreJsObject.lockDownButtons(o,!1)}}})},generateProgressIdentifier:function(e,r){return r+"_"+e},download_tmp_path:"",doStatusActions:function(r,o,s,t,i,n){if(r){if("stoptracking"===r){if(!1===PrimeMoverCoreJsObject[o])return;clearTimeout(PrimeMoverCoreJsObject[o]),PrimeMoverCoreJsObject[o]=!1,n=!1,"import"===s?(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(i,"Import stop tracking detected, processing import result handler",s,"doStatusActions"),PrimeMoverCoreJsObject.import_result_handler(i,t.import_result)):(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(i,"Export stop tracking detected, processing export success handler",s,"doStatusActions"),PrimeMoverCoreJsObject.export_success_handler(i,t.export_result)),PrimeMoverCoreJsObject.lockDownButtons(i,!1)}else if("diffdetected"===r){if(!1===PrimeMoverCoreJsObject[o])return;clearTimeout(PrimeMoverCoreJsObject[o]),PrimeMoverCoreJsObject[o]=!1,n=!1,PrimeMoverCoreJsObject.logProcessingErrorAnalysis(i,"Diff detected, processing import result handler diff processor",s,"doStatusActions"),PrimeMoverCoreJsObject.import_result_handler(i,t.import_result)}else if("package_downloaded"===r){if(!1===PrimeMoverCoreJsObject[o])return;clearTimeout(PrimeMoverCoreJsObject[o]),PrimeMoverCoreJsObject[o]=!1,n=!1,PrimeMoverCoreJsObject.logProcessingErrorAnalysis(i,"Package downloaded detected processing download success handler",s,"doStatusActions"),PrimeMoverCoreJsObject.download_success_handler(i,t.download_result)}else if("downloading_package"===r){if(!1===PrimeMoverCoreJsObject[o])return;if("total_download_size"in t&&"ongoing_size"in t){var p="#js-multisite_import_progress_span_"+i;e(p).html(prime_mover_js_ajax_renderer.prime_mover_downloading_progress_text+"..<progress title=\""+prime_mover_js_ajax_renderer.prime_mover_download_percent_progress+"\" value=\"0\"></progress>"),e(p+" progress").attr({value:t.ongoing_size,max:t.total_download_size})}"download_tmp_path"in t&&(PrimeMoverCoreJsObject.download_tmp_path=t.download_tmp_path)}else if("uploading_to_dropbox"===r){if(!1===PrimeMoverCoreJsObject[o])return;if("total_upload_size"in t&&"ongoing_size"in t){var p="#js-multisite_export_progress_span_"+i;e(p).html(prime_mover_js_ajax_renderer.prime_mover_dropbox_upload_progress_text+"..<progress title\""+prime_mover_js_ajax_renderer.prime_mover_dropbox_upload_progress+"\" value=\"0\"></progress>"),e(p+" progress").attr({value:t.ongoing_size,max:t.total_upload_size})}}else if("uploading_to_gdrive"===r){if(!1===PrimeMoverCoreJsObject[o])return;if("total_upload_size"in t&&"ongoing_size"in t){var p="#js-multisite_export_progress_span_"+i;e(p).html(prime_mover_js_ajax_renderer.prime_mover_gdrive_upload_progress_text+"..<progress title\""+prime_mover_js_ajax_renderer.prime_mover_gdrive_upload_progress+"\" value=\"0\"></progress>"),e(p+" progress").attr({value:t.ongoing_size,max:t.total_upload_size})}}else{if(!1===PrimeMoverCoreJsObject[o])return;PrimeMoverCoreJsObject.logProcessingErrorAnalysis(i,"Ongoing status: "+r,s,"doStatusActions");"boot"!=r&&e("#js-multisite_"+s+"_progress_span_"+i).text(r)}}else if(t.logexist&&t.error_msg){if(!1===PrimeMoverCoreJsObject[o])return;clearTimeout(PrimeMoverCoreJsObject[o]),PrimeMoverCoreJsObject[o]=!1,n=!1,PrimeMoverCoreJsObject.logProcessingErrorAnalysis(i,"Fatal runtime errors found during progress status check, aborting..",s,"doStatusActions"),PrimeMoverCoreJsObject.displayRunTimeError(i,s,"doStatusActions",t)}else PrimeMoverCoreJsObject.logProcessingErrorAnalysis(i,"Status not defined:"+r,s,"doStatusActions");return n},progressAjax:function(r,o,s,t,i,n){if("undefined"==typeof n)var n={};e.ajax({url:ajaxurl,type:"post",data:r,retryLimit:prime_mover_js_ajax_renderer.prime_mover_retry_limit,success:function(e){if(r.trackercount++,PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Generic success response received for progress ajax.",o,"progressAjax"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,e,o,"progressAjax"),PrimeMoverCoreJsObject.prime_mover_is_js_object(e)){if("import"===o)var p=e.import_status;else var p=e.export_status;var a=prime_mover_js_ajax_renderer.prime_mover_standard_progress_interval;"boot"===p&&(a=prime_mover_js_ajax_renderer.prime_mover_upload_refresh_interval),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Progress identifier is: "+t,o,"progressAjax"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Progress identifier status is: "+p,o,"progressAjax"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Progress interval used is: "+a,o,"progressAjax"),PrimeMoverCoreJsObject[t]=p;var _=!0;"bootup"in e&&e.bootup?(PrimeMoverCoreJsObject[t]="boot",PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Bootup Response",o,"progressAjax"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,n,o,"progressAjax"),PrimeMoverCoreJsObject.doBootActions(o,s,n)):_=PrimeMoverCoreJsObject.doStatusActions(p,i,o,e,s,_),_&&(PrimeMoverCoreJsObject[i]=setTimeout(function(){PrimeMoverCoreJsObject.progressAjax(r,o,s,t,i)},a))}else{r.noresponsecount++;var l=prime_mover_js_ajax_renderer.prime_mover_progress_error_message;if("string"==typeof e&&(l=l.replace("{{PROGRESSSERVERERROR}}",e),l=l.replace("{{BLOGID}}",s)),clearprogressspans=!0,r.noresponsecount<=this.retryLimit){var _=!0;PrimeMoverCoreJsObject[i]=setTimeout(function(){PrimeMoverCoreJsObject.progressAjax(r,o,s,t,i)},prime_mover_js_ajax_renderer.prime_mover_standard_progress_interval)}else if(r.noresponsecount>this.retryLimit){PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"The NO RESPONSE progress ajax request has reached a retry limit.",o,"progressAjax"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Limit try count: "+r.noresponsecount,o,"progressAjax"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Retry limit: "+this.retryLimit,o,"progressAjax"),PrimeMoverCoreJsObject.stop_interval_clear_progress_text(s,!0,o,!0);var m=PrimeMoverCoreJsObject.getGenericFailSelector(s);!1===PrimeMoverCoreJsObject.dialogIsOpen(m,!0)&&PrimeMoverCoreJsObject.user_notices(m,s,o,clearprogressspans,l),PrimeMoverCoreJsObject.lockDownButtons(s,!1)}}},error:function(e,p,a){PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Error detected on ajax track progress request, error thrown is "+a,o,"progressAjax"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Progress failed request detected, retrying again.",o,"progressAjax"),a||(a=prime_mover_js_ajax_renderer.prime_mover_unknown_js_error),r.errorcount++;var _=prime_mover_js_ajax_renderer.prime_mover_progress_error_message;if(_=_.replace("{{PROGRESSSERVERERROR}}",a),_=_.replace("{{BLOGID}}",s),clearprogressspans=!0,r.errorcount<=this.retryLimit)PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"The progress ajax request has been retried.",o,"progressAjax"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Current try count: "+r.errorcount,o,"progressAjax"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Retry limit: "+this.retryLimit,o,"progressAjax"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Arguments passed to progress re-sending:",o,"progressAjax"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,n,o,"progressAjax"),PrimeMoverCoreJsObject[i]=setTimeout(function(){PrimeMoverCoreJsObject.progressAjax(r,o,s,t,i,n)},prime_mover_js_ajax_renderer.prime_mover_standard_progress_interval);else if(r.errorcount>this.retryLimit){PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"The progress ajax request has reached a retry limit.",o,"progressAjax"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Limit try count: "+r.errorcount,o,"progressAjax"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Retry limit: "+this.retryLimit,o,"progressAjax"),PrimeMoverCoreJsObject.stop_interval_clear_progress_text(s,!0,o,!0);var l=PrimeMoverCoreJsObject.getGenericFailSelector(s);!1===PrimeMoverCoreJsObject.dialogIsOpen(l,!0)&&PrimeMoverCoreJsObject.user_notices(l,s,o,clearprogressspans,_),PrimeMoverCoreJsObject.lockDownButtons(s,!1)}}})},prime_mover_track_progress:function(e,r,o,s){if("undefined"==typeof e)var e="import";if("undefined"==typeof o)var o=!1;if("undefined"==typeof s)var s={};var t=this.generateUniqueIdentifier(e,r),i=this.generateProgressIdentifier(t,e);PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Progress tracking requested with the following parameters",e,"prime_mover_track_progress"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Blog ID: "+r,e,"prime_mover_track_progress"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Mode: "+e,e,"prime_mover_track_progress"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Refresh ID: "+t,e,"prime_mover_track_progress"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Progress Identifier: "+i,e,"prime_mover_track_progress");var n={action:"prime_mover_monitor_"+e+"_progress",dataType:"json",blog_id:r};"import"===e?n.prime_mover_import_progress_nonce=prime_mover_js_ajax_renderer.prime_mover_import_progress_nonce:n.prime_mover_export_progress_nonce=prime_mover_js_ajax_renderer.prime_mover_export_progress_nonce,n.trackercount=1,n.errorcount=0,n.noresponsecount=0,n.diffmode=o,PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Progress triggered, starting progress ajax...",e,"prime_mover_track_progress"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,s,e,"prime_mover_track_progress"),this.progressAjax(n,e,r,i,t,s)},shutdown_process:function(r,o,s){var t={action:"prime_mover_shutdown_"+r+"_process",dataType:"json",process_id:o,blog_id:s};"import"===r?t.prime_mover_import_shutdown_nonce=prime_mover_js_ajax_renderer.prime_mover_import_shutdown_nonce:t.prime_mover_export_shutdown_nonce=prime_mover_js_ajax_renderer.prime_mover_export_shutdown_nonce,PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,r+" shutdown started ajax request for"+o,r,"shutdown_process"),e.ajax({url:ajaxurl,type:"post",data:t,retryLimit:prime_mover_js_ajax_renderer.prime_mover_retry_limit,tryCount:0,success:function(e){"status"in e?PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Response received: "+e.status,r,"shutdown_process"):PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Empty response received",r,"shutdown_process")},error:function(e,o,t){PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Error dected on shutdown request, error thrown is "+t,r,"shutdown_process"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Retrying the shutdown request...",r,"shutdown_process");var i=this;PrimeMoverCoreJsObject.doErrorHandling(s,r,i,null,!0,"shutdown_process")}})},import_result_handler:function(r,o){var s=o;if(!0===s.status){if(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Import success detected. Clearing intervals.","import","import_result_handler"),PrimeMoverCoreJsObject.import_success_handler(r,s),PrimeMoverCoreJsObject.stop_interval_clear_progress_text(r,!1),"process_id"in s){var t=s.process_id;PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Import shutdown requested to server for process id"+t,"import","import_result_handler"),PrimeMoverCoreJsObject.shutdown_process("import",t,r)}}else if(!0===s.diff_detected){PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Diff processed.","import","import_result_handler"),PrimeMoverCoreJsObject.shutdown_process("import",s.process_id,r);var i="#js-prime-mover-import-diff-confirm-"+r;e(i).html(s.diff);var n=e(i).data();n.myObj_prime_mover_import_status=s,e(i).dialog({resizable:!1,height:600,width:"auto",maxWidth:600,dialogClass:"prime-mover-user-dialog",modal:!0,fluid:!0,buttons:[{text:prime_mover_js_ajax_renderer.yes_button,class:"button-primary",click:function(){e(this).dialog("close"),e(i).text(""),PrimeMoverCoreJsObject.user_approves_diff(s,r)}},{text:prime_mover_js_ajax_renderer.no_button,click:function(){e(this).dialog("close"),PrimeMoverCoreJsObject.lockDownButtons(r,!1),PrimeMoverCoreJsObject.doAfterClose(i,s,r)}}],create:function(){e(this).closest("div.ui-dialog").find(".ui-dialog-titlebar-close").click(function(o){s=n.myObj_prime_mover_import_status,PrimeMoverCoreJsObject.doAfterClose(i,s,r),PrimeMoverCoreJsObject.lockDownButtons(r,!1),o.preventDefault()})}}),PrimeMoverCoreJsObject.handle_responsive_dialog()}else{e("#js-multisite_import_span_"+r).html(s.import_not_successful),e("#js-multisite_import_span_"+r).css("color","red"),PrimeMoverCoreJsObject.stop_interval_clear_progress_text(r),e("#js-multisite_import_span_"+r).parent().addClass("notice notice-error"),e("#js-multisite_import_span_"+r).css("width","100%"),e("#js-multisite_import_span_"+r).css("float","none");var t=s.process_id;PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Error occurred and Import shutdown requested to server for process id"+t,"import","import_result_handler"),PrimeMoverCoreJsObject.shutdown_process("import",t,r)}},download_success_handler:function(r,o){if(o.download_status){PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Response download status defined, value is "+o.download_status,"import","download_success_handler"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Response package encrypted status, value is "+o.encrypted,"import","download_success_handler"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Response package description type, value is "+o.package_description,"import","download_success_handler"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Response message, value is "+o.message,"import","download_success_handler"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Response site title value is "+o.site_title,"import","download_success_handler"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Response download URL value is "+o.source,"import","download_success_handler"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Response download package size is "+o.package_size,"import","download_success_handler");var s="#js-prime-mover-wrong-importedsite-"+r;if(o.package_description)o.encrypted&&"can_decrypt"in o&&"decryption_error"in o&&!o.can_decrypt?(PrimeMoverCoreJsObject.user_notices(s,r,"import",!0,o.decryption_error),PrimeMoverCoreJsObject.lockDownButtons(r,!1)):o.encrypted_media&&"can_decrypt_media"in o&&!o.can_decrypt_media?(PrimeMoverCoreJsObject.user_notices(s,r,"import",!0,prime_mover_js_ajax_renderer.prime_mover_media_decryption_error),PrimeMoverCoreJsObject.lockDownButtons(r,!1)):PrimeMoverCoreJsObject.generalImportWarningDialog(r,"",!0,o.message,"restore_from_remote_url",o.encrypted,o.package_description,o.site_title,o.source,o.package_size,o.encrypted_media);else{var t=prime_mover_js_ajax_renderer.prime_mover_invalid_package;"decryption_error"in o&&(t=o.decryption_error),PrimeMoverCoreJsObject.user_notices(s,r,"import",!0,t),PrimeMoverCoreJsObject.lockDownButtons(r,!1)}}else PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Response download status is not defined.","import","download_success_handler"),PrimeMoverCoreJsObject.import_failed_handler(r,o.message,!1),PrimeMoverCoreJsObject.stop_interval_clear_progress_text(r),e("#js-multisite_import_span_"+r).addClass("notice notice-error prime-mover-corrupt-package-error"),PrimeMoverCoreJsObject.lockDownButtons(r,!1);PrimeMoverCoreJsObject.shutdown_process("import",o.process_id,r)},export_success_handler:function(r,o){var s=o;if(!0!==s.status)"export_not_successful"in s&&(e("#js-prime_mover_export_progress_span_p_"+r).addClass("notice notice-error"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Export not successful received:"+s.export_not_successful,"export","export_success_handler"),e("#js-multisite_export_span_"+r).html(s.export_not_successful),e("#js-multisite_export_span_"+r).css("color","red"),PrimeMoverCoreJsObject.stop_interval_clear_progress_text(r,!0,"export"));else if(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Export final success clearing intervals.","export","export_success_handler"),PrimeMoverCoreJsObject.stop_interval_clear_progress_text(r,!0,"export"),e("#js-multisite_export_span_"+r).html(""),e("#js-prime_mover_export_progress_span_p_"+r).addClass("notice notice-success"),"download_link"in s&&"generated_filename"in s){PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Streaming download link.","export","export_success_handler");"prime_mover_export_downloaded"in s&&(e("#js-multisite_export_span_"+r).html(s.prime_mover_export_downloaded),PrimeMoverCoreJsObject.user_notices("#js-prime-mover-export-done-dialog-"+r,r,"",!1,s.download_link,"",!1,".js-prime-move-download-button-hero-"+r))}else PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Showing download link.","export","export_success_handler"),e("#js-multisite_export_span_"+r).html("<p style='margin-top:10px;'>"+s.message+"</p>"),PrimeMoverCoreJsObject.showClipBoardButtonIfSupported(r,s.restore_url);if("process_id"in s){var t=s.process_id;PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Export shutdown requested to server for process id"+t,"export","export_success_handler"),PrimeMoverCoreJsObject.shutdown_process("export",t,r)}},prime_mover_set_export_location:function(r){var o="default";if(!e(".js-prime_mover_target_export_location_class").length)return o;return e("input#js-prime-mover-targetexportloc-"+r).is(":checked")&&(o="export_directory"),o},prime_mover_set_encryption_option:function(r){var o=!1;if(!e(".js-prime-mover-encryptiondb_class").length)return o;return e("input#js-prime-mover-encryptiondb-"+r).is(":checked")&&(o=!0),o},prime_mover_set_userexport_option:function(r){var o=!1;if(!e(".js-prime-mover-userexport_class").length)return o;return e("input#js-prime-mover-userexport-"+r).is(":checked")&&(o=!0),o},prime_mover_set_dropbox_option:function(r){var o=!1;if(!e(".js-prime_mover_dropbox_class").length)return o;return e("input#js-prime-mover-savetodropbox-"+r).is(":checked")&&(o=!0),o},prime_mover_set_forceutf8_option:function(r){var o=!1;if(!e(".js-prime_mover_forceutf8dump_class").length)return o;return e("input#js-prime-mover-forceutf8dump-"+r).is(":checked")&&(o=!0),o},prime_mover_set_gdrive_option:function(r){var o=!1;if(!e(".js-prime_mover_gdrive_class").length)return o;return e("input#js-prime-mover-savetogdrive-"+r).is(":checked")&&(o=!0),o},prime_mover_get_targetexport_id:function(r){var o=!1,s=0,t=this.getExportType(r);if(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Analyzed export type: "+t,"export","prime_mover_get_targetexport_id"),"single-site-export"===t)return PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Single site export triggered","export","prime_mover_get_targetexport_id"),1;if("multisite-export"===t&&(o=!0),"multisitebackup-export"===t)return r;if(o){PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Multisite export triggered","export","prime_mover_get_targetexport_id");var i=e("#js-prime-mover-export-targetid-"+r).val();return(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Multisite export retrieved target ID: "+i,"export","prime_mover_get_targetexport_id"),i=i.trim(),i)?(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Multisite export target ID: "+i,"export","prime_mover_get_targetexport_id"),i):(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Multisite export target ID: "+s,"export","prime_mover_get_targetexport_id"),s)}return PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Not multisite export target ID: "+s,"export","prime_mover_get_targetexport_id"),s},returnProgressCircleMarkup:function(){return"<div class=\"progress-circle\" title=\""+prime_mover_js_ajax_renderer.prime_mover_overall_percent_progress+"\"><span>0%</span><div class=\"left-half-clipper\"><div class=\"first50-bar\"></div><div class=\"value-bar\"></div></div></div>"},getExportType:function(r){var o=e("input[name=prime-mover-export-type-"+r+"]:checked").val();return o},prime_mover_exporter:function(r,o){var s=this.returnProgressCircleMarkup(),t=this.prime_mover_set_export_location(o),i=this.prime_mover_set_encryption_option(o),n=this.prime_mover_set_userexport_option(o),p=this.prime_mover_set_dropbox_option(o),a=this.prime_mover_set_forceutf8_option(o),_=this.prime_mover_set_gdrive_option(o),l=this.prime_mover_get_targetexport_id(o),m=this.getExportType(o);e("#js-multisite_export_span_"+o).html(s);var d={action:"prime_mover_process_export",dataType:"json",prime_mover_export_nonce:prime_mover_js_ajax_renderer.prime_mover_export_nonce,multisite_blogid_to_export:o,multisite_export_options:r,multisite_export_location:t,prime_mover_encrypt_db:i,prime_mover_userexport_setting:n,prime_mover_dropbox_upload:p,prime_mover_force_utf8:a,prime_mover_gdrive_upload:_,prime_mover_export_targetid:l,prime_mover_export_type:m};PrimeMoverCoreJsObject.prime_mover_track_progress("export",o,!1,d)},showClipBoardButtonIfSupported:function(r,o){var s="#js-prime-mover-copy-url-clipboard-"+r;e(s).length&&(e(s).show(),e(s).attr("data-clipboard-text",o))},getBlogIDfromFolderName:function(e){if(!e)return!1;var r=e.replace(/\/$/,""),o=r.split("_"),s=o.pop();return+s},logProcessingErrorAnalysis:function(e,r,o,s){"undefined"!=typeof s&&s||(s="not defined"),prime_mover_js_ajax_renderer.prime_mover_upload_error_analysis&&(this.prime_mover_is_js_object(r)?(console.log(o+" log for BlogID "+e+" Object result Functional Source: "+s),console.log(r)):console.log(o+" log for BlogID "+e+": "+r+" Functional Source: "+s))},getErrorSelectors:function(e){var r="#js-multisite_import_span_";return"export"===e&&(r="#js-multisite_export_span_"),r},displayRunTimeError:function(r,o,s,t){PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Error handling found error log file.",o,s);var i=this.getErrorSelectors(o);e(i+r).html(t.error_msg),e(i+r).css("color","red"),e(i+r).parent().addClass("notice notice-error"),"import"===o&&PrimeMoverCoreJsObject.stop_interval_clear_progress_text(r),"export"===o&&PrimeMoverCoreJsObject.stop_interval_clear_progress_text(r,!0,"export"),e("#js-multisite_import_span_"+r).css("float","none"),e("#js-multisite_import_span_"+r).css("width","100%"),PrimeMoverCoreJsObject.lockDownButtons(r,!1)},doErrorHandling:function(r,o,s,t,i,n){"undefined"==typeof s&&(s=null),"undefined"==typeof t&&(t=""),"undefined"==typeof i&&(i=!0),"undefined"==typeof n&&(n="");var p="import",a={action:"prime_mover_check_if_error_log_exist",dataType:"json",prime_mover_errorlog_nonce:prime_mover_js_ajax_renderer.prime_mover_errorlog_nonce,error_blog_id:r},_=PrimeMoverCoreJsObject.getErrorSelectors(o);"export"===o&&(p="export"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Starting doErrorHandling before ajax post.",p,n),e.ajax({url:ajaxurl,type:"post",data:a,retryLimit:prime_mover_js_ajax_renderer.prime_mover_retry_limit,tryCount:0,success:function(e){var o=e;o.logexist&&o.error_msg?PrimeMoverCoreJsObject.displayRunTimeError(r,p,n,o):s?i&&(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"No error log file, we are retrying the ajax "+p+" request.",p,n),PrimeMoverCoreJsObject.retryAjaxHandler(s,p,r)):t&&(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"No error log file and ajax handler object not set OR retry is set to false, we are displaying an error notice for "+p+" request.",p,n),PrimeMoverCoreJsObject.user_notices(t+r,r,"import",!0))},error:function(e,o,t){this.tryCount++,PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,p+" retry mode is"+i,p,n),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"The error handling ajax returns an error.",p,n),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"The error returned is "+t,p,n),i&&(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"We are now retrying the original "+p+" request",p,n),PrimeMoverCoreJsObject.retryAjaxHandler(s,p,r,n))}})},retryHelper:function(r){e.ajax(r)},retryAjaxHandler:function(e,r,o,s){if("undefined"!=typeof o){if("undefined"==typeof s&&(s=""),!e)return void PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Ajax handler object is not defined.",r,s);if(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Retry ajax handler method called.",r,s),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Set retry limit is "+e.retryLimit,r,s),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Current retry count is "+e.tryCount,r,s),"import"===r){if(e.tryCount<=e.retryLimit)return PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"The original ajax request has been retried.",r,s),void setTimeout(function(){PrimeMoverCoreJsObject.retryHelper(e)},prime_mover_js_ajax_renderer.prime_mover_retry_request_resending);if(e.tryCount>e.retryLimit){PrimeMoverCoreJsObject.stop_interval_clear_progress_text(o,!0,r,!0);var t=PrimeMoverCoreJsObject.getGenericFailSelector(o);if(!1===PrimeMoverCoreJsObject.dialogIsOpen(t,!0)){var i="";"errorReturned"in e&&(i=e.errorReturned);var n=!1,p=0,a="";PrimeMoverCoreJsObject.lockDownButtons(o,!1),"clearprogressspans"in e&&(n=e.clearprogressspans,p=o,a=r),PrimeMoverCoreJsObject.user_notices(t,p,a,n,i)}}}}},getGenericFailSelector:function(e){return"#js-prime-mover-import-generic-fail-"+e},user_notices:function(r,o,s,t,i,n,p,a,_){"undefined"==typeof o&&(o=0),"undefined"==typeof s&&(s=""),"undefined"==typeof t&&(t=!1),"undefined"==typeof i&&(i=""),"undefined"!=typeof n&&n||(n="prime-mover-user-dialog"),"undefined"==typeof p&&(p=!1),"undefined"==typeof a&&(a=r+" p"),"undefined"==typeof _&&(_="");var l=e(r).data(),m=".js-prime-move-download-button-hero-"+o+" a";l.blog_id=o,l.mode=s,l.clearprogress=t,i&&e(a).html(i),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"We are displaying a user notice with following args.",s,"user_notices"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Selector: "+r,s,"user_notices"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Clear progress: "+t,s,"user_notices"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Text: "+i,s,"user_notices");var d={resizable:!1,height:"auto",minWidth:320,maxWidth:600,dialogClass:n,modal:!0,title:_,fluid:!0,buttons:[{text:prime_mover_js_ajax_renderer.ok_button,class:"button-primary",click:function(){var o=this;e(o).dialog("close"),PrimeMoverCoreJsObject.runThisWhenUserNoticeIsClosed(o,r)}}],create:function(){var o=this;e(o).closest("div.ui-dialog").find(".ui-dialog-titlebar-close").click(function(){PrimeMoverCoreJsObject.runThisWhenUserNoticeIsClosed(o,r)})},open:function(){e(".ui-dialog a").blur(),e(m).length&&e(m).fadeTo(750,.6).fadeTo(750,1).fadeTo(750,.6).fadeTo(750,1)},close:function(){p&&"single-site"===prime_mover_js_ajax_renderer.prime_mover_environment&&location.reload()}};_||delete d.title,e(r).dialog(d),PrimeMoverCoreJsObject.handle_responsive_dialog()},runThisWhenUserNoticeIsClosed:function(r,o){var s=e(r).data("blog_id"),t=e(r).data("mode"),i=e(r).data("clearprogress");PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"A user notice is closed with the following parameters:",t,"user_notices"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Multisite ID: "+s,t,"user_notices"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Clear progress: "+i,t,"user_notices"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"Mode: "+t,t,"user_notices"),s&&i&&t&&(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(s,"A clear progress has been successfully requested after closing notice.",t,"user_notices"),PrimeMoverCoreJsObject.cleanProgressSpans(s,t)),PrimeMoverCoreJsObject.initializeDialogMonitor(o,!0)},initiateSpinner:function(r,o){"undefined"==typeof o&&(o="upload");var s=prime_mover_js_ajax_renderer.prime_mover_spinner_upload_text;"download"===o&&(s=prime_mover_js_ajax_renderer.prime_mover_spinner_download_text),"zip_analysis"===o&&(s=prime_mover_js_ajax_renderer.prime_mover_spinner_zipanalysis_text);var t=PrimeMoverCoreJsObject.returnProgressCircleMarkup();e("#js-multisite_import_span_"+r).html(t),e("#js-multisite_import_progress_span_"+r).html(s+"..<progress title=\""+prime_mover_js_ajax_renderer.prime_mover_file_transfer_progress+"\" value=\"0\"></progress>")},user_confirms_import_to_proceed:function(e,r){PrimeMoverCoreJsObject.processFile(r,e)},validate_if_server_upload_limits_insufficient:function(e){$insufficient=!1;var r=prime_mover_js_ajax_renderer.prime_mover_upload_max_size;return e>r&&($insufficient=!0),$insufficient},compute_recommended_upload_parameters:function(e){var r=e,o=Math.ceil(r+.1*r);return o},import_success_handler:function(r,o){"undefined"==typeof o&&(o=null);var s=prime_mover_js_ajax_renderer.prime_mover_complete_import_png,t="";o&&this.prime_mover_is_js_object(o)&&(s=o.import_successful,t=o.completion_text),0<parseInt(r)&&(e("#js-prime_mover_import_progress_span_p_"+r).addClass("notice notice-success"),e("#js-multisite_import_span_"+r).html(""),e("#js-multisite_import_span_"+r).html(s),e("#js-multisite_import_progress_span_"+r).html(prime_mover_js_ajax_renderer.prime_mover_restore_done),PrimeMoverCoreJsObject.user_notices("#js-prime-mover-import-done-dialog-"+r,r,"",!1,t,"prime-mover-success-import-dialog",!0,"#js-prime-mover-import-done-dialog-"+r+" h3"))},import_failed_handler:function(r,o,s){"undefined"==typeof s&&(s=!0);r&&(this.prime_mover_is_js_object(o)?e("#js-multisite_import_span_"+r).html(o.import_not_successful):e("#js-multisite_import_span_"+r).html(o),s&&e("#js-multisite_import_span_"+r).css("color","red"))},cleanProgressSpans:function(r,o){"undefined"==typeof o&&(o="import");var s="#js-prime_mover_"+o+"_progress_span_p_"+r+" span";e(s).html(""),e(s).removeAttr("style")},stop_interval_clear_progress_text:function(r,o,s,t){"undefined"==typeof o&&(o=!0),"undefined"==typeof s&&(s="import"),"undefined"==typeof t&&(t=!1);var i=this.generateUniqueIdentifier(s,r);0<parseInt(r)&&(o&&e("#js-multisite_"+s+"_progress_span_"+r).text(""),this.isUniqueIdentifierSet(i)&&(clearTimeout(PrimeMoverCoreJsObject[i]),PrimeMoverCoreJsObject[i]=!1),t&&e("#js-multisite_"+s+"_span_"+r).text(""))},prime_mover_is_js_object:function(e){return e===Object(e)},slice:function(e,r,o){var s=e.mozSlice?e.mozSlice:e.webkitSlice?e.webkitSlice:e.slice?e.slice:noop;return s.bind(e)(r,o)},noop:function(){},compute_canonical_total_chunks:function(e,r){var o=e/r;return o=Math.ceil(o),o},processFile:function(e,r){function o(){var d=p+n;0>t-d&&(d=t);var c=PrimeMoverCoreJsObject.slice(e,p,d);PrimeMoverCoreJsObject.outputProcessFileDebugLog(p,d,m,a,n,t,i),PrimeMoverCoreJsObject[_][m]={slice_start:p,slice_end:d},PrimeMoverCoreJsObject.send(c,p,d,m,a,r,e,n,l),m++,d<t&&(p+=n,PrimeMoverCoreJsObject[l]=setTimeout(o,prime_mover_js_ajax_renderer.prime_mover_upload_refresh_interval))}var t=e.size,i=PrimeMoverCoreJsObject.measuredUploadSpeed(r),n=this.calculateChunkSizeBasedOnUploadSpeed(i),p=0,a=this.compute_canonical_total_chunks(t,n),_=this.generateUploadId(r);PrimeMoverCoreJsObject[_]={};var l=this.generateUniqueIdentifier("upload",r);PrimeMoverCoreJsObject[l]=setTimeout(o,prime_mover_js_ajax_renderer.prime_mover_upload_refresh_interval);var m=1},outputProcessFileDebugLog:function(e,r,o,s,t,i,n){prime_mover_js_ajax_renderer.prime_mover_debug_uploads&&(console.log("******************************"),console.log("start: "+e),console.log("end: "+r),console.log("chunk: "+o),console.log("chunks: "+s),console.log("sliceSize: "+t),console.log("size: "+i),console.log("upload: "+n),console.log("******************************"))},generateUploadId:function(e){return"uploadID_"+e},send:function(r,o,s,t,i,n,p,a,_,l,m,d,c){"undefined"==typeof l&&(l=0),"undefined"==typeof m&&(m=0),"undefined"==typeof d&&(d=""),"undefined"==typeof c&&(c=0);var g=new FormData,u=p.name;g.set("action","prime_mover_process_uploads"),g.set("prime_mover_uploads_nonce",prime_mover_js_ajax_renderer.prime_mover_uploads_nonce),g.set("multisite_blogid_to_import",n),g.set("start",o),g.set("end",s),m||g.set("file",r,u),g.set("chunk",t),g.set("chunks",i),g.set("missing_chunk_to_fix",l),g.set("resume_parts_index",m),g.set("resume_filepath",d),g.set("resume_chunks",c),jQuery.ajax({url:ajaxurl,type:"post",data:g,cache:!1,contentType:!1,processData:!1,tryCount:0,errorReturned:"",clearprogressspans:!0,retryLimit:prime_mover_js_ajax_renderer.prime_mover_retry_limit,success:function(r){var o=r;if("assembled"in o&&!0===o.assembled)PrimeMoverCoreJsObject.logProcessingErrorAnalysis(n,"Stopping upload intervals for ID: "+_,"import","send"),PrimeMoverCoreJsObject.isUniqueIdentifierSet(_)&&(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(n,"Package assembled, stopping upload intervals","import","send"),clearTimeout(PrimeMoverCoreJsObject[_]));else if("status"in o&&!0===o.status&&"done"in o&&!1===o.done&&"actualprogress"in o){var s=o.chunk,t=o.chunks,i=o.actualprogress;e("#js-multisite_import_progress_span_"+n+" progress").attr({value:i,max:t})}else if("done"in o&&!0===o.done&&"filepath"in o&&o.filepath){var l=o.filepath;PrimeMoverCoreJsObject.logProcessingErrorAnalysis(n,"Upload completed","import","send"),PrimeMoverCoreJsObject.import_handler(n,l)}else if("missing_chunk"in o){var m=PrimeMoverCoreJsObject.generateUploadId(n),d=o.missing_chunk;PrimeMoverCoreJsObject.logProcessingErrorAnalysis(n,"Processing missing chunk found: "+d,"import","send");var c=p.size,g=p.name,t=PrimeMoverCoreJsObject.compute_canonical_total_chunks(c,a),u=PrimeMoverCoreJsObject[m],v=u[d].slice_start,h=u[d].slice_end,f=PrimeMoverCoreJsObject.slice(p,v,h);PrimeMoverCoreJsObject.outputMissingChunkDebugLog(d,c,g,a,t,v,h),PrimeMoverCoreJsObject[_]=setTimeout(function(){PrimeMoverCoreJsObject.send(f,v,h,d,t,n,p,a,_,d)},prime_mover_js_ajax_renderer.prime_mover_upload_refresh_interval)}else if("resume_parts_index"in o&&o.resume_parts_index&&"resume_filepath"in o&&o.resume_filepath&&"resume_chunks"in o&&o.resume_chunks){var y=o.resume_parts_index,x=o.resume_filepath,E=o.resume_chunks;PrimeMoverCoreJsObject[_]=setTimeout(function(){PrimeMoverCoreJsObject.send(0,0,0,0,0,n,p,a,_,0,y,x,E)},prime_mover_js_ajax_renderer.prime_mover_upload_refresh_interval)}else"error"in o&&o.error&&(PrimeMoverCoreJsObject.stop_interval_clear_progress_text(n,!0,"import",!0),e("#js-multisite_import_span_"+n).html(o.error),e("#js-multisite_import_span_"+n).addClass("notice notice-error prime-mover-corrupt-package-error"),PrimeMoverCoreJsObject.lockDownButtons(n,!1))},error:function(e,r,o){if(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(n,"Error returned by AJAX chunk upload, textStatus is: "+r,"import","send"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(n,"Error returned by AJAX chunk upload, error thrown is: "+o,"import","send"),this.tryCount++,o){var s=prime_mover_js_ajax_renderer.prime_mover_upload_error_message;s=s.replace("{{UPLOADSERVERERROR}}",o),s=s.replace("{{BLOGID}}",n),this.errorReturned=s,this.clearprogressspans=!0}var t=this;PrimeMoverCoreJsObject.doErrorHandling(n,"import",t,"",!0,"send")}})},dialogOpened:[],initializeDialogMonitor:function(e,r){"undefined"==typeof r&&(r=!1),"undefined"==typeof this.dialogOpened[e]&&(this.dialogOpened[e]=1),r&&(this.dialogOpened[e]=1)},dialogIsOpen:function(r,o){var s=!1;return e(r).hasClass("ui-dialog-content")&&e(r).dialog("isOpen")&&(s=!0),"undefined"==typeof o&&(o=!1),o?(this.initializeDialogMonitor(r),!1!==s||1!==this.dialogOpened[r]||(this.dialogOpened[r]++,!1)):s},outputMissingChunkDebugLog:function(e,r,o,s,t,i,n){prime_mover_js_ajax_renderer.prime_mover_debug_uploads&&(console.log("******************************"),console.log("Requesting to re-upload missing chunk "+e),console.log("Missing start: "+i),console.log("Missing end: "+n),console.log("Re-uploading chunk request Filesize test: "+r),console.log("Re-uploading chunk request Filename test"+o),console.log("Re-uploading chunk request Slice size test: "+s),console.log("Total chunks of entire upload package is: "+t),console.log("******************************"))},compute_end_of_missing_chunk:function(e,r,o,s){var t=0;return t=r===o?s:e*r,t},user_approves_diff:function(e,r){var o=e.results;o=JSON.stringify(o);var s=e.continue_nonce,t=e.next_method,i=e.current_method,n="",p="";"unzipped_directory"in e&&(n=e.unzipped_directory),"process_id"in e&&(p=e.process_id),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Next method in DIFF "+t,"import","user_approves_diff"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Current method in DIFF "+i,"import","user_approves_diff"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Unzipped directory in DIFF "+n,"import","user_approves_diff");var a=new FormData;a.set("action","prime_mover_process_import"),a.set("nonce_to_continue",s),a.set("data_to_continue",o),a.set("diff_blog_id",r),a.set("prime_mover_next_import_method",t),a.set("prime_mover_current_import_method",i),a.set("unzipped_directory",n),a.set("process_id",p),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"User approves diff, now resending ajax.","import","user_approves_diff"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,a,"import","user_approves_diff"),PrimeMoverCoreJsObject.prime_mover_track_progress("import",r,!0,a)},user_rejects_diff:function(e,r){"unzipped_directory"in e.results&&PrimeMoverCoreJsObject.requestToDeleteTmpFile(e.results.unzipped_directory,r,!0)},requestToDeleteTmpFile:function(r,o,s,t,i,n){if(r){"undefined"==typeof t&&(t=!0),"undefined"==typeof i&&(i="import"),"undefined"==typeof n&&(n="no");var p={action:"multisite_tempfile_cancel",dataType:"json",temp_file_to_delete:r,prime_mover_deletetmpfile_nonce:prime_mover_js_ajax_renderer.prime_mover_deletetmpfile_nonce,diff_reject:s,blog_id:o,mode:i,tmp_file_mode:n};e.post(ajaxurl,p,function(r){if(t){e("#js-multisite_import_span_"+o).html(""),r.tempfile_deletion_status?PrimeMoverCoreJsObject.user_notices("#js-prime-mover-cancel-import-diff-"+o):PrimeMoverCoreJsObject.user_notices("#js-prime-mover-cancel-import-diff-fail-"+o)}}),PrimeMoverCoreJsObject.stop_interval_clear_progress_text(o)}},computeOverallPercentProgress:function(r,o,s){var t=[];"export"===o&&(t=prime_mover_js_ajax_renderer.prime_mover_export_method_lists),"import"===o&&(t=prime_mover_js_ajax_renderer.prime_mover_import_method_lists);var i=t.indexOf(r),n=t.length,p=Math.floor(100*((i+1)/n));percent=p+"%";var a="#js-multisite_"+o+"_span_"+s+" .progress-circle",_="p"+p;50<=p&&(_="over50 "+_),e(a).addClass(_),e(a+" span").text(percent)},doExporterAjax:function(r,o,s,t){if("undefined"==typeof s&&(s=0),"undefined"==typeof t)var t=[];var i=new Date().getTime();e.post(ajaxurl,o,function(e){if(PrimeMoverCoreJsObject.prime_mover_is_js_object(e)&&"next_method"in e&&"current_method"in e){var s=e.next_method,t=e.current_method;PrimeMoverCoreJsObject.computeOverallPercentProgress(t,"export",r),o.prime_mover_next_export_method=s,o.prime_mover_current_export_method=t;var i="";"temp_folder_path"in e&&(i=e.temp_folder_path),o.temp_folder_path=i;var n="";"process_id"in e&&(n=e.process_id),o.process_id=n,setTimeout(function(){PrimeMoverCoreJsObject.doExporterAjax(r,o)},prime_mover_js_ajax_renderer.prime_mover_standard_immediate_resending)}}).fail(function(e,n,p){var a=new Date().getTime()-i;t.push(a);var _=t.reduce((e,r)=>e+r)/1e3;PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Total time spent retrying: "+_,void 0,"doExporterAjax");var l=PrimeMoverCoreJsObject.generateUniqueIdentifier("export",r);if(!1!==PrimeMoverCoreJsObject[l]){var m=prime_mover_js_ajax_renderer.prime_mover_unknown_export_process_error;PrimeMoverCoreJsObject.prime_mover_is_js_object(o)&&"prime_mover_next_export_method"in o&&(m=o.prime_mover_next_export_method);var d=this,c=prime_mover_js_ajax_renderer.prime_mover_totalwaiting_seconds_error,g=Math.round(_/(s+1));p||(p=prime_mover_js_ajax_renderer.prime_mover_unknown_js_error);var u=prime_mover_js_ajax_renderer.prime_mover_exportprocess_error_message;u=u.replace("{{PROGRESSSERVERERROR}}",p),u=u.replace("{{BLOGID}}",r),u=u.replace("{{EXPORTMETHODWITHERROR}}",m),u=u.replace("{{RETRYSECONDS}}",g),u=u.replace("{{FIXEDSECONDS}}",g);if(_>c){PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"The exporter ajax request has reached a retry limit.","export","doExporterAjax"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Total time spent seconds: "+_,"doExporterAjax"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Retry total time specs "+c,"export","doExporterAjax"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"The exporter process data at time of error is: ","export","doExporterAjax"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,o,"export","doExporterAjax");var v="";PrimeMoverCoreJsObject.prime_mover_is_js_object(o)&&"process_id"in o&&(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Process id with error: "+v,"export","doExporterAjax"),v=o.process_id),v&&(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Shutdown requested on export error","export","doExporterAjax"),PrimeMoverCoreJsObject.shutdown_process("export",v,r));var h="";PrimeMoverCoreJsObject.prime_mover_is_js_object(o)&&"temp_folder_path"in o&&(h=o.temp_folder_path),h&&PrimeMoverCoreJsObject.requestToDeleteTmpFile(h,r,!1,!1,"export"),PrimeMoverCoreJsObject.stop_interval_clear_progress_text(r,!0,"export",!0);var f=PrimeMoverCoreJsObject.getGenericFailSelector(r);!1===PrimeMoverCoreJsObject.dialogIsOpen(f,!0)&&PrimeMoverCoreJsObject.user_notices(f,r,"export",!0,u),PrimeMoverCoreJsObject.lockDownButtons(r,!1)}else s++,PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Export request has been tried: "+s,"export","doExporterAjax"),setTimeout(function(){PrimeMoverCoreJsObject.doExporterAjax(r,o,s,t)},prime_mover_js_ajax_renderer.prime_mover_retry_request_resending)}})},import_handler:function(r,o,s,t,i){if("undefined"==typeof s&&(s=0),"undefined"==typeof t)var t=new FormData;if("undefined"==typeof i)var i=[];var n=new Date().getTime();t.set("action","prime_mover_process_import"),t.set("prime_mover_import_nonce",prime_mover_js_ajax_renderer.prime_mover_import_nonce),t.set("multisite_blogid_to_import",r),t.set("multisite_import_package_uploaded_file",o),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Import_handling requested for this blog. Starting import..","import","import_handler"),e.ajax({url:ajaxurl,type:"post",data:t,cache:!1,contentType:!1,processData:!1,tryCount:0,retryLimit:prime_mover_js_ajax_renderer.prime_mover_retry_limit,success:function(e){if(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Response received","import","import_handler"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,e,"import","import_handler"),PrimeMoverCoreJsObject.prime_mover_is_js_object(e)&&"next_method"in e&&"current_method"in e){var i=e.next_method,n=e.current_method;PrimeMoverCoreJsObject.computeOverallPercentProgress(n,"import",r);var p="",a="";"unzipped_directory"in e&&(p=e.unzipped_directory),"process_id"in e&&(a=e.process_id),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Next import method to process:","import","import_handler"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,i,"import","import_handler"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Current method being processed:","import","import_handler"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,n,"import","import_handler"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"The current ajax data to re-post is:","import","import_handler"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,t,"import","import_handler"),t.set("prime_mover_next_import_method",i),t.set("prime_mover_current_import_method",n),t.set("unzipped_directory",p),t.set("process_id",a),setTimeout(function(){PrimeMoverCoreJsObject.import_handler(r,o,s,t)},prime_mover_js_ajax_renderer.prime_mover_standard_immediate_resending)}},error:function(e,p,a){var _=PrimeMoverCoreJsObject.generateUniqueIdentifier("import",r);if(!1!==PrimeMoverCoreJsObject[_]){this.tryCount++;var l=this;PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Error found on import_handler() ajax request, starting error handling and retrying..","import","import_handler");var m=!1,d=PrimeMoverCoreJsObject.generateProgressIdentifier(_,"import");if(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Progress identifier at import_handler error handler: "+d,"import","import_handler"),"undefined"!=typeof PrimeMoverCoreJsObject[d]){var c=PrimeMoverCoreJsObject[d];PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"At import handler error, latest progress found is "+c,"import","import_handler"),"boot"===c&&(m=!0,PrimeMoverCoreJsObject.logProcessingErrorAnalysis(r,"Still boot process, retrying to avoid stuck on this stage."+c,"import","import_handler"))}m?PrimeMoverCoreJsObject.doErrorHandling(r,"import",l,null,m,"import_handler"):PrimeMoverCoreJsObject.doImportHandlingRetry(t,a,r,s,o,!1,n,i)}}})},getValueFromFormData:function(e,r){var o="",s=[];return PrimeMoverCoreJsObject.prime_mover_is_js_object(e)&&e.has(r)&&(s=e.getAll(r),o=s[s.length-1]),o},doImportHandlingRetry:function(e,r,o,s,t,i,n,p){var a=new Date().getTime()-n;p.push(a);var _=p.reduce((e,r)=>e+r)/1e3,l=PrimeMoverCoreJsObject.getValueFromFormData(e,"prime_mover_next_import_method");l||(l=prime_mover_js_ajax_renderer.prime_mover_unknown_import_process_error);var m=prime_mover_js_ajax_renderer.prime_mover_retry_limit,d="import";r||(error=prime_mover_js_ajax_renderer.prime_mover_unknown_js_error);var m=prime_mover_js_ajax_renderer.prime_mover_totalwaiting_seconds_error,c=Math.round(_/(s+1));PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Current total time spent trying: "+_,d,"doImportHandlingRetry"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Current retry limit setting: "+m,d,"doImportHandlingRetry");var g=prime_mover_js_ajax_renderer.prime_mover_importprocess_error_message;g=g.replace("{{PROGRESSSERVERERROR}}",r),g=g.replace("{{BLOGID}}",o),g=g.replace("{{IMPORTMETHODWITHERROR}}",l),g=g.replace("{{RETRYSECONDS}}",c),g=g.replace("{{FIXEDSECONDS}}",c);if(_>m){PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"The importer ajax request has reached a retry limit.",d,"doImportHandlingRetry"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Total time retrying: "+_,"doImportHandlingRetry"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Retry limit set in seconds: "+m,d,"doImportHandlingRetry"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Post approval diff mode is"+i,d,"doImportHandlingRetry"),PrimeMoverCoreJsObject.stop_interval_clear_progress_text(o,!0,d,!0);var u=PrimeMoverCoreJsObject.getValueFromFormData(e,"process_id");PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Process id with error: "+u,d,"doImportHandlingRetry"),u&&(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Shutdown requested on import error",d,"doImportHandlingRetry"),PrimeMoverCoreJsObject.shutdown_process("import",u,o));var v=PrimeMoverCoreJsObject.getValueFromFormData(e,"unzipped_directory");PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Unzipped directory that need to be deleted: "+v,d,"doImportHandlingRetry"),v&&PrimeMoverCoreJsObject.requestToDeleteTmpFile(v,o,!1,!1);var h=PrimeMoverCoreJsObject.getGenericFailSelector(o);!1===PrimeMoverCoreJsObject.dialogIsOpen(h,!0)&&PrimeMoverCoreJsObject.user_notices(h,o,d,!0,g),PrimeMoverCoreJsObject.lockDownButtons(o,!1)}else s++,PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"IMPORTER REQUEST HAS BEEN TRIED: "+s,d,"doImportHandlingRetry"),i?(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"RETRYING IMPORT FOR NEXT METHOD IN DIFF MODE",d,"doImportHandlingRetry"),setTimeout(function(){PrimeMoverCoreJsObject.doDiffPostAjax(d,o,e,s,p)},prime_mover_js_ajax_renderer.prime_mover_retry_request_resending)):(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"RETRYING IMPORT FOR NEXT METHOD IN STANDARD MODE",d,"doImportHandlingRetry"),setTimeout(function(){PrimeMoverCoreJsObject.import_handler(o,t,s,e,p)},prime_mover_js_ajax_renderer.prime_mover_retry_request_resending))},doDiffPostAjax:function(r,o,s,t,i){if("undefined"==typeof t&&(t=0),"undefined"==typeof i)var i=[];var n=new Date().getTime();PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Continue diff processing...",r,"doDiffPostAjax"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,s,r,"doDiffPostAjax"),e.ajax({url:ajaxurl,type:"post",data:s,cache:!1,contentType:!1,processData:!1,success:function(e){if(PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"Success response after diff approval received",r,"doDiffPostAjax"),PrimeMoverCoreJsObject.prime_mover_is_js_object(e)&&"next_method"in e&&"current_method"in e){var t=e.next_method,i=e.current_method;PrimeMoverCoreJsObject.computeOverallPercentProgress(i,"import",o),s.set("prime_mover_next_import_method",t),s.set("prime_mover_current_import_method",i),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"After diff approval next import method"+t,r,"doDiffPostAjax"),PrimeMoverCoreJsObject.logProcessingErrorAnalysis(o,"After diff approval current import method"+i,r,"doDiffPostAjax"),setTimeout(function(){PrimeMoverCoreJsObject.doDiffPostAjax(r,o,s)},prime_mover_js_ajax_renderer.prime_mover_standard_immediate_resending)}},error:function(e,r,p){PrimeMoverCoreJsObject.doImportHandlingRetry(s,p,o,t,"",!0,n,i)}})},doAfterClose:function(r,o,s){e(r).text(""),PrimeMoverCoreJsObject.user_rejects_diff(o,s)},fluidDialog:function(){var r=e(".ui-dialog:visible");r.each(function(){var r=e(this),o=r.find(".ui-dialog-content").data("ui-dialog");if(o.options.fluid){var s=e(window).width();if(s<parseInt(o.options.maxWidth)+50)r.css("max-width","90%");else{var t=.9*parseInt(o.options.maxWidth);r.css("max-width",t+"px")}o.option("position",o.options.position)}})},handle_responsive_dialog:function(){e(window).resize(function(){PrimeMoverCoreJsObject.fluidDialog()}),PrimeMoverCoreJsObject.fluidDialog()}}})(jQuery);